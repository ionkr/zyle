<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/png" href="/icon.png" />
    <title>Zyle Console Analyzer - Demo</title>
    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        background: #f5f5f5;
        min-height: 100vh;
        padding: 40px;
      }

      .container {
        max-width: 800px;
        margin: 0 auto;
      }

      h1 {
        font-size: 32px;
        margin-bottom: 8px;
        color: #1a1a1a;
      }

      .subtitle {
        color: #666;
        margin-bottom: 32px;
      }

      .card {
        background: white;
        border-radius: 12px;
        padding: 24px;
        margin-bottom: 24px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
      }

      h2 {
        font-size: 18px;
        margin-bottom: 16px;
        color: #333;
      }

      .button-group {
        display: flex;
        flex-wrap: wrap;
        gap: 12px;
      }

      button {
        padding: 12px 20px;
        border: none;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: transform 0.15s, box-shadow 0.15s;
      }

      button:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      }

      button:active {
        transform: translateY(0);
      }

      .btn-log {
        background: #e3f2fd;
        color: #1565c0;
      }

      .btn-warn {
        background: #fff3e0;
        color: #e65100;
      }

      .btn-error {
        background: #ffebee;
        color: #c62828;
      }

      .btn-network {
        background: #e8f5e9;
        color: #2e7d32;
      }

      .btn-network.fail {
        background: #fce4ec;
        color: #ad1457;
      }

      .instructions {
        background: #f5f5f5;
        border-radius: 8px;
        padding: 16px;
        font-size: 14px;
        color: #555;
      }

      .instructions ul {
        margin: 12px 0 0 20px;
      }

      .instructions li {
        margin-bottom: 8px;
      }

      code {
        background: #e8e8e8;
        padding: 2px 6px;
        border-radius: 4px;
        font-family: 'SF Mono', Monaco, monospace;
        font-size: 13px;
      }

      .footer {
        text-align: center;
        padding: 20px;
        color: #999;
        font-size: 14px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Zyle</h1>
      <p class="subtitle">콘솔 로그 분석 및 원인 안내 라이브러리 데모</p>

      <div class="card">
        <h2>콘솔 로그 테스트</h2>
        <div class="button-group">
          <button class="btn-log" onclick="testLog()">console.log 테스트</button>
          <button class="btn-log" onclick="testInfo()">console.info 테스트</button>
          <button class="btn-warn" onclick="testWarn()">console.warn 테스트</button>
          <button class="btn-error" onclick="testError()">console.error 테스트</button>
        </div>
      </div>

      <div class="card">
        <h2>JavaScript 에러 테스트</h2>
        <div class="button-group">
          <button class="btn-error" onclick="testTypeError()">TypeError 발생</button>
          <button class="btn-error" onclick="testReferenceError()">ReferenceError 발생</button>
          <button class="btn-error" onclick="testSyntaxError()">JSON Parse Error</button>
          <button class="btn-error" onclick="testPromiseError()">Promise Rejection</button>
        </div>
      </div>

      <div class="card">
        <h2>네트워크 요청 테스트</h2>
        <div class="button-group">
          <button class="btn-network" onclick="testFetchSuccess()">성공하는 요청</button>
          <button class="btn-network fail" onclick="testFetch404()">404 에러</button>
          <button class="btn-network fail" onclick="testFetch500()">500 에러</button>
          <button class="btn-network fail" onclick="testFetchCORS()">CORS 에러</button>
          <button class="btn-network fail" onclick="testFetchTimeout()">타임아웃</button>
        </div>
      </div>

      <div class="card instructions">
        <h2>사용 방법</h2>
        <ul>
          <li><strong>우측 하단의 보라색 버튼</strong>을 클릭하면 로그 분석 패널이 열립니다.</li>
          <li>버튼을 <strong>드래그</strong>하여 원하는 위치로 이동할 수 있습니다.</li>
          <li>로그를 클릭하면 <strong>상세 분석 결과</strong>를 확인할 수 있습니다.</li>
          <li>에러 발생 시 <strong>원인 추론</strong>과 <strong>해결 방안</strong>을 제시합니다.</li>
        </ul>
      </div>

      <div class="card">
        <h2>API 사용 예시</h2>
        <pre><code>import { Zyle } from 'zyle';

const zyle = new Zyle({
  position: 'bottom-right',
  draggable: true,
  captureConsole: true,
  captureNetwork: true,
  sourceMapSupport: true,
  theme: 'auto',
});

// 이벤트 리스닝
zyle.on('log:captured', (entry) => {
  console.log('New log:', entry);
});

// 수동으로 분석 실행
const results = await zyle.analyzeErrors();</code></pre>
      </div>

      <div class="footer">
        Zyle &copy; 2025
      </div>
    </div>

    <script type="module">
      import { Zyle } from './src/index.ts';

      // Zyle 초기화
      const zyle = new Zyle({
        position: 'bottom-right',
        draggable: true,
        captureConsole: true,
        captureNetwork: true,
        sourceMapSupport: true,
        theme: 'auto',
      });

      // 전역으로 노출 (테스트용)
      window.zyle = zyle;

      // 이벤트 리스닝
      zyle.on('log:captured', (entry) => {
        // console.log('[Zyle] Log captured:', entry.level, entry.message);
      });

      zyle.on('analysis:complete', (result) => {
        // console.log('[Zyle] Analysis complete:', result);
      });
    </script>

    <script>
      // 테스트 함수들
      function testLog() {
        console.log('일반 로그 메시지입니다.', { key: 'value', nested: { a: 1, b: 2 } });
      }

      function testInfo() {
        console.info('정보성 메시지입니다.', 'Multiple', 'arguments');
      }

      function testWarn() {
        console.warn('경고! 이 기능은 곧 deprecated될 예정입니다.');
      }

      function testError() {
        console.error('에러가 발생했습니다!', new Error('Something went wrong'));
      }

      function testTypeError() {
        try {
          const obj = null;
          obj.property.nested;
        } catch (e) {
          console.error(e);
        }
      }

      function testReferenceError() {
        try {
          undefinedVariable.doSomething();
        } catch (e) {
          console.error(e);
        }
      }

      function testSyntaxError() {
        try {
          JSON.parse('{ invalid json }');
        } catch (e) {
          console.error(e);
        }
      }

      function testPromiseError() {
        Promise.reject(new Error('Unhandled Promise Rejection Test'));
      }

      async function testFetchSuccess() {
        try {
          const response = await fetch('https://jsonplaceholder.typicode.com/posts/1');
          const data = await response.json();
          console.log('API 응답:', data);
        } catch (e) {
          console.error('Fetch error:', e);
        }
      }

      async function testFetch404() {
        try {
          const response = await fetch('https://jsonplaceholder.typicode.com/posts/99999');
          if (!response.ok) {
            throw new Error(`HTTP ${response.status}: Not Found`);
          }
        } catch (e) {
          console.error('404 Error:', e);
        }
      }

      async function testFetch500() {
        try {
          const response = await fetch('https://httpstat.us/500');
          if (!response.ok) {
            throw new Error(`HTTP ${response.status}: Internal Server Error`);
          }
        } catch (e) {
          console.error('500 Error:', e);
        }
      }

      async function testFetchCORS() {
        try {
          await fetch('https://example.com/api/restricted');
        } catch (e) {
          console.error('CORS Error:', e);
        }
      }

      async function testFetchTimeout() {
        const controller = new AbortController();
        setTimeout(() => controller.abort(), 100);

        try {
          await fetch('https://httpstat.us/200?sleep=5000', {
            signal: controller.signal,
          });
        } catch (e) {
          console.error('Timeout Error:', e);
        }
      }
    </script>
  </body>
</html>
